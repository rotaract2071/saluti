<!DOCTYPE html>
<html lang="it">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Saluti</title>
	<style>
		* {
			font-family: system-ui, sans-serif;
		}
	</style>
	<script type="module">
		const form = document.querySelector("form")
		const template = document.querySelector("template")
		const button = document.querySelector("button")
		const ol = document.querySelector("ol")

		const now = new Date()
		const currentYear = now.getFullYear() - (now.getMonth() <= 6 ? 1 : 0)

		button.addEventListener("click", (ev) => {
			button.insertAdjacentElement("beforebegin", template.content.firstElementChild.cloneNode(true))
		})

		form.addEventListener("submit", (ev) => {
			ev.preventDefault()
			const list = Array.from(form.querySelectorAll("fieldset"))
				.map((f) => ({
					name: f.querySelector('input[name="name"]').value,
					role: f.querySelector('select[name="role"]').selectedOptions[0].innerText,
					sortOrder: parseInt(f.querySelector('select[name="role"]').value),
					year: parseInt(f.querySelector('input[name="year"]').value),
				}))
				.filter(({ name, year }) => name !== "" && !isNaN(year))
				.sort((a, b) => {
					if (a.sortOrder === b.sortOrder) {
						if (a.year === currentYear) return -1
						if (b.year === currentYear) return 1
						return a.year - b.year
					}
					return a.sortOrder - b.sortOrder
				})
				.map(({ name, role, year }) => {
					const li = document.createElement("li")
					li.innerText = `${name}, ${role} per l'A.R. ${year}/${year + 1}`
					return li
				})
			ol.innerHTML = ""
			ol.append(...list)
		})

		button.click()
	</script>
</head>

<body class="container">
	<main style="display: grid; grid-template-columns: repeat(2, minmax(0%, 1fr));">
		<form>
			<template>
				<fieldset>
					<label>
						Nome
						<input type="text" name="name" oninput="this.closest('form').requestSubmit()">
					</label>
					<label>
						Carica
						<select name="role" onchange="this.closest('form').requestSubmit()">
							<optgroup label="Direttivo distrettuale">
								<option value="1">Rappresentante Distrettuale</option>
								<option value="2">Segretario Distrettuale</option>
								<option value="3">Tesoriere Distrettuale</option>
								<option value="4">Prefetto Distrettuale</option>
							</optgroup>
							<optgroup label="Esecutivo distrettuale">
								<option value="10">Presidente di commissione</option>
								<option value="11">Delegato di zona</option>
							</optgroup>
							<optgroup label="Cariche di club">
								<option value="100">Presidente</option>
								<option value="101">Vicepresidente</option>
								<option value="103">Segretario</option>
								<option value="104">Tesoriere</option>
								<option value="105">Prefetto</option>
								<option value="106">Consigliere</option>
							</optgroup>
						</select>
					</label>
					<label>
						A.R.
						<input type="number" name="year" min="1900" max="2100" oninput="this.closest('form').requestSubmit()">
					</label>
					<button type="button" onclick="this.parentElement.remove(); this.closest('form').requestSubmit()">-</button>
				</fieldset>
			</template>
			<button type="button">+</button>
		</form>
		<ol></ol>
	</main>
</body>

</html>
